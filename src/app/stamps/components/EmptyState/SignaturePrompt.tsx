import { motion, MotionProps, useAnimationFrame, useMotionValue } from 'framer-motion';
import { useMemo } from 'react';

const defaultPathProps: Partial<MotionProps> = {
  variants: {
    initial: { pathLength: 0, opacity: 0 },
    animate: { pathLength: 1, opacity: 1 },
  },
  transition: { duration: 0.25, opacity: { duration: 0 }, ease: 'easeIn' },
};

const defaultGroupProps: Partial<MotionProps> = {
  variants: {
    initial: { pathLength: 0, opacity: 0 },
    animate: (custom: number = 1) => ({
      pathLength: 1,
      opacity: 1,
      transition: {
        staggerChildren: 0.15 * custom,
      },
    }),
  },
  initial: 'initial',
};

export function SignaturePrompt({
  className,
  animate,
  shouldAnimate,
  pathProps: overridePathProps,
  groupProps: overrideGroupProps,
}: {
  className?: string;
  animate?: boolean;
  shouldAnimate?: boolean;
  pathProps?: MotionProps;
  groupProps?: MotionProps;
}) {
  const groupProps = useMemo(
    () => ({
      ...defaultGroupProps,
      animate: shouldAnimate ? (animate ? 'animate' : 'initial') : 'animate',
      custom: shouldAnimate ? 1 : 0,
      ...overrideGroupProps,
    }),
    [animate, overrideGroupProps, shouldAnimate],
  );

  const pathProps = useMemo(
    () => ({
      ...defaultPathProps,
      transition: {
        duration: shouldAnimate ? (animate ? 0.25 : 0) : 0,
      },
      ...overridePathProps,
    }),
    [overridePathProps, animate, shouldAnimate],
  );

  return (
    <motion.svg
      className={className}
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 486 127"
      aria-label="Select a stamp to see the details"
    >
      <motion.g
        stroke="currentColor"
        strokeLinecap="round"
        strokeLinejoin="round"
        strokeMiterlimit="10"
        strokeWidth="1.5"
        {...groupProps}
      >
        {/* select */}
        <motion.path
          d="M86.8917 49.4259C84.574 47.7098 82.4665 49.8371 83.2742 52.5439C84.0282 55.0725 91.7269 61.799 86.4096 63.8411C85.607 64.1492 83.9581 64.133 83.178 63.7861C80.4514 62.5726 80.5444 59.8748 83.3667 57.8483C86.929 55.2904 99.1712 51.2886 97.7534 48.7728C97.4818 48.2908 96.5504 48.0593 95.0667 48.7804C92.0086 50.2667 89.5458 59.6035 97.0226 57.1572C98.1519 56.7877 98.9138 56.0913 99.2295 55.6871"
          {...pathProps}
        />
        <motion.path
          d="M97.9038 56.579C100.218 55.6218 103.03 52.864 104.678 49.3139C109.188 40.6546 102.732 37.5671 100.559 47.9015C99.9192 50.9423 100.012 54.0622 100.299 56.2055C101.75 67.047 114.298 54.5681 112.3 51.1292C110.035 48.42 103.533 58.2809 111.144 59.9854C114.122 60.6523 116.149 58.2674 116.633 56.979"
          {...pathProps}
        />
        <motion.path
          d="M122.383 52.5757C123.684 51.2949 121.145 50.2947 120.098 50.5717C115.953 51.6692 115.675 57.7774 120.142 58.6243C125.58 59.6552 132.962 50.7315 131.033 42.6019C130.924 38.2144 128.851 61.892 132.526 58.2716"
          {...pathProps}
        />
        <motion.path
          d="M125.55 45.827C126 44.8765 134.091 44.8665 136.321 43.7523"
          {...pathProps}
        />

        {/* a */}
        <motion.path
          d="M153.104 46.169C157.381 43.1465 160.532 49.1455 159.219 52.3005C159.059 52.5754 158.868 51.3885 157.021 50.5917C154.867 49.6625 152.459 50.6159 152.441 53.0489C152.408 57.3833 159.279 54.5739 160.962 53.2845"
          {...pathProps}
        />

        {/* stamp */}
        <motion.path
          d="M181.867 43.7681C181.951 41.8045 179.174 40.8224 178.288 43.2C177.409 46.4877 183.304 58.408 178.654 56.1054C170.171 49.5793 191.628 49.7399 191.255 39.6132C190.91 30.2351 188.364 55.1207 192.279 51.7084"
          {...pathProps}
        />
        <motion.path
          d="M184.011 40.5132C183.724 40.3276 192.482 39.7854 194.699 39.9778"
          {...pathProps}
        />
        <motion.path
          d="M197.36 41.1203C203.356 38.2291 205.516 46.7973 203.81 51.8803C203.369 52.1405 199.005 42.476 196.018 47.5342C192.866 53.4596 202.697 51.9784 205.361 50.4035"
          {...pathProps}
        />
        <motion.path
          d="M207.311 44.3749C207.964 45.4353 208.473 47.0742 208.604 48.2855C208.676 48.9586 208.863 50.9265 209.031 50.2704C209.409 48.8017 208.089 40.9923 210.412 41.2485C213.515 41.5897 215.175 46.9331 214.842 49.8888C214.805 50.2091 214.812 50.5839 214.812 50.5839C214.718 50.1172 214.476 42.4777 216.079 42.0012C219.632 40.946 218.222 51.9266 222.188 51.0732"
          {...pathProps}
        />
        <motion.path
          d="M223.578 40.43C223.045 45.9974 225.995 51.2047 225.673 56.6582C225.374 52.3616 222.476 41.5649 227.932 39.6561C234.915 37.2146 233.22 48.9429 225.559 48.8922"
          {...pathProps}
        />

        {/* to */}
        <motion.path
          d="M109.802 70.3097C113.313 71.1897 110.581 82.6128 112 85.5336C113.223 88.0502 116.283 87.6395 117.185 85.2761"
          {...pathProps}
        />
        <motion.path
          d="M107.025 77.0221C110.793 72.401 126.067 78.4858 124.88 75.9222C122.253 70.251 115.338 86.41 125.391 84.2553C132.387 82.7557 128.886 73.5669 121.431 76.184"
          {...pathProps}
        />

        {/* see */}
        <motion.path
          d="M149.157 75.3221C150.073 72.6396 145.875 68.7742 144.729 72.1303C143.137 76.7898 148.763 81.6468 147.782 86.3691C147.256 88.902 141.906 87.1265 141.184 85.3151C137.773 76.7611 160.641 78.6796 160.933 75.267C161.147 72.726 152.223 72.5036 154.131 79.5182C156.087 84.63 161.502 83.3128 164.708 79.7243"
          {...pathProps}
        />
        <motion.path
          d="M165.342 79.2763C167.536 77.7816 170.985 73.2178 166.706 73.6559C162.036 75.5981 164.174 85.0133 172.005 82.1935"
          {...pathProps}
        />

        {/* the */}
        <motion.path
          d="M185.518 65.1649C189.336 64.7113 181.307 82.6813 187.623 84.1097"
          {...pathProps}
        />
        <motion.path
          d="M181.959 76.0211C181.695 74.7534 197.301 74.667 196.331 67.9773C194.356 61.4138 189.808 78.3557 192.744 81.553C193.316 82.1763 193.5 80.2961 194.369 78.671C195.055 77.1915 196.706 73.8815 198.821 74.1401C201.551 74.4743 200.312 79.6721 202.892 80.9005C206.277 82.5115 211.942 74.951 208.44 74.0348C206.492 73.5253 205.498 76.1558 205.842 77.8333C206.66 81.8209 211.213 82.1173 213.341 79.2248"
          {...pathProps}
        />

        {/* details */}
        <motion.path
          d="M233.636 76.7415C233.636 76.7415 231.697 69.8948 229.522 71.6804C226.402 74.2435 226.411 79.5696 228.227 80.4112C235.327 83.7033 234.28 61.8487 234.28 61.8487C234.091 63.9916 232.014 75.6618 236.03 78.3511C242.106 82.4204 247.238 69.4299 243.119 70.0915C238.775 70.7892 239.5 75.8433 241.05 77.3503C243.599 79.8274 248.479 78.1441 250.74 72.8594"
          {...pathProps}
        />
        <motion.path
          d="M251.352 64.8768C251.349 64.4941 251.222 63.3688 251.345 63.7306C252.129 66.0388 248.147 82.7925 255.916 74.9352"
          {...pathProps}
        />
        <motion.path
          d="M257.144 69.0228C262.197 66.2739 264.694 70.0901 263.785 73.8257C263.622 74.4353 263.705 72.3125 261.199 71.3931C259.658 70.8988 256.801 71.5375 256.917 73.4241C257.179 77.6996 265.549 75.8084 267.683 72.8629"
          {...pathProps}
        />
        <motion.path
          d="M269.474 66.3387C266.395 68.1209 266.583 79.2505 272.188 73.5808"
          {...pathProps}
        />
        <motion.path d="M272.098 62.7603L271.099 61.6966" {...pathProps} />
        <motion.path
          d="M272.248 68.2777C276.832 70.5375 281.224 58.2188 278.533 58.2346C272.675 58.2673 271.534 79.6572 280.144 73.1222"
          {...pathProps}
        />
        <motion.path
          d="M286.762 67.9277C288.666 64.0647 284.045 63.696 283.323 66.5575C282.601 69.4192 287.159 70.8051 285.85 73.4615C285.277 74.623 281.971 75.088 281.323 70.8372"
          {...pathProps}
        />
        <motion.path
          d="M247.335 67.7539C246.793 67.7798 250.911 66.965 251.496 66.7887C253.429 66.205 255.354 65.5889 257.302 65.0565"
          {...pathProps}
        />

        {/* arrow */}
        <motion.path
          d="M293.863 91.9734C306.777 94.729 333.211 90.3102 335.629 50.59C338.651 0.939703 401.822 38.2929 420.046 17.7792"
          className="hidden lg:block"
          {...pathProps}
        />
        <motion.path
          d="M410.773 29.9154C413.915 28.0452 420.267 22.9615 420.542 17.5885C417.971 18.7396 411.315 18.6559 405.125 16.8004"
          className="hidden lg:block"
          {...pathProps}
        />

        {/* arrow mobile */}
        <motion.path
          d="M293.666 50.9194C305.532 43.2367 337.708 35.1739 353.91 50.9194C377.341 73.6906 356.718 89.1474 346.192 81.0399C334.047 71.6857 360.834 41.4367 379.24 71.6857C388.245 86.4844 382.055 106.296 373.992 110.023"
          {...pathProps}
          className="lg:hidden"
        />
        <motion.path
          d="M372.3 99.1403C373.827 103.86 373.757 106.898 373.746 110.501C376.403 110.101 380.899 108.737 383.774 105.386"
          {...pathProps}
          className="lg:hidden"
        />
      </motion.g>
    </motion.svg>
  );
}

export function SignaturePromptSmall({
  className,
  animate,
  shouldAnimate,
  pathProps: overridePathProps,
  groupProps: overrideGroupProps,
}: {
  className?: string;
  animate?: boolean;
  shouldAnimate?: boolean;
  pathProps?: MotionProps;
  groupProps?: MotionProps;
}) {
  const groupProps = useMemo(
    () => ({
      ...defaultGroupProps,
      animate: shouldAnimate ? (animate ? 'animate' : 'initial') : 'animate',
      custom: shouldAnimate ? 1 : 0,
      ...overrideGroupProps,
    }),
    [animate, overrideGroupProps, shouldAnimate],
  );

  const pathProps = useMemo(
    () => ({
      ...defaultPathProps,
      transition: {
        duration: shouldAnimate ? (animate ? 0.25 : 0) : 0,
      },
      ...overridePathProps,
    }),
    [overridePathProps, animate, shouldAnimate],
  );

  const dashOffset = useMotionValue(0);
  const runDash = shouldAnimate ? Boolean(animate) : true;

  useAnimationFrame((t) => {
    const period = 5;
    const speed = 8;

    dashOffset.set(runDash ? ((t / 1000) * speed) % period : 0);
  });

  return (
    <motion.svg
      className={className}
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 132 93"
      aria-label="Select a stamp to see the details"
    >
      <motion.g
        stroke="currentColor"
        strokeLinecap="round"
        strokeLinejoin="round"
        strokeMiterlimit="10"
        strokeWidth="1.5"
        {...groupProps}
      >
        {/* arrow */}
        <motion.path
          d="M82.7379 73.8841C80.1735 96.9088 53.3415 92.26 49.373 76.7141C46.9199 67.1046 51.6491 58.6632 61.0799 56.3621C68.38 53.8864 83.1071 54.4577 82.7379 73.8841Z"
          style={{
            strokeDashoffset: dashOffset,
          }}
          strokeDasharray="2px 3px"
        />
        <motion.path
          d="M67.9034 64.5103C67.9034 64.5103 66.9994 67.6478 66.8222 72.5841C66.645 77.5203 65.428 82.9949 65.428 82.9949M65.428 82.9949C63.1622 81.8264 59.2468 75.3184 57.5723 72.2105M65.428 82.9949C68.2603 84.4556 70.4056 73.2802 73.678 73.0696"
          {...pathProps}
        />

        {/* tap */}
        <motion.path
          d="M15.0457 12.0144C14.7444 10.5625 14.7502 15.4727 14.7334 16.1333C14.6655 18.8421 13.9965 22.9721 15.041 25.5515C15.9703 27.8473 20.3454 24.2029 21.2005 23.4473"
          {...pathProps}
        />
        <motion.path
          d="M11.2306 18.7844C13.6855 19.4345 16.9204 18.1526 19.3098 17.6558"
          {...pathProps}
        />
        <motion.path
          d="M25.0925 16.3859C25.946 13.1631 30.8293 16.2945 30.2935 20.2523C30.0808 21.8267 28.7272 19.5875 26.8723 19.4736C23.4233 19.2619 23.1159 21.7949 23.6512 23.0066C24.8541 25.7305 30.3042 23.2826 31.4496 21.9832"
          {...pathProps}
        />
        <motion.path
          d="M34.1734 16.9489C33.4871 19.54 33.9949 22.9206 34.0147 25.595C34.0227 26.6668 33.9328 27.9535 34.0399 29.0251C34.0582 29.2052 34.0591 29.6296 34.2152 29.5386C35.2902 28.9135 31.7686 15.7746 36.0297 14.4573C43.733 12.0764 39.2012 22.1809 34.0101 23.2598"
          {...pathProps}
        />

        {/* here */}
        <motion.path
          d="M48.109 16.2135C47.5973 16.2429 50.3204 14.2581 50.9949 13.6074C52.3105 12.3393 58.7676 5.5636 57.4537 3.63366C56.492 2.22182 54.1532 5.94114 53.8782 6.43497C51.9892 9.81766 51.7965 13.7604 51.768 17.5598C51.7584 18.8031 51.7929 20.0501 51.9303 21.2872C51.9858 21.7799 52.2627 23.2424 52.1966 22.7512C52.0142 21.402 51.6908 20.2443 51.7389 18.8589C51.7767 17.7731 51.7713 16.7913 52.3161 15.8153C56.2859 8.70508 56.7536 20.0496 60.2487 19.277C61.4749 19.0062 66.0915 13.5788 64.8757 12.6526C63.9512 12.075 63.5786 12.471 63.4237 12.5765C61.2326 14.0684 61.8184 19.6784 65.4853 19.1832C67.7417 18.8784 68.8614 14.5989 70.7277 13.3279"
          {...pathProps}
        />
        <motion.path
          d="M70.9158 11.1885C70.7158 12.2434 70.8879 13.3984 70.9488 14.4571C71.0242 15.7676 71.0716 18.3946 71.0716 18.3946C71.0716 18.3946 71.2438 17.7698 71.2507 17.4496C71.2863 15.862 71.0948 14.1673 71.5169 12.6072C71.9669 10.9435 73.8328 10.4372 75.3529 10.7257"
          {...pathProps}
        />
        <motion.path
          d="M76.9798 14.1874C78.3893 15.7311 83.6294 15.3698 83.3747 12.5734C83.0587 9.10563 71.7343 19.4345 82.2398 18.5553C83.3232 18.4647 83.2321 18.4236 84.288 18.0744"
          {...pathProps}
        />

        {/* to */}
        <motion.path
          d="M98.3673 6.65103C98.1432 6.90432 97.3648 17.6264 97.554 17.9509C98.9544 20.3605 101.595 16.7919 101.93 15.5305"
          {...pathProps}
        />
        <motion.path
          d="M95.4412 12.4122C94.6674 12.2071 98.0321 11.9544 98.6959 11.8736C100.747 11.6221 102.533 11.6443 104.531 12.1726C104.602 12.1922 106.167 12.7765 106.062 12.2673C106.041 12.1691 105.863 12.1525 105.771 12.19C104.452 12.7237 104.752 15.0829 105.574 15.8728C106.734 16.9884 108.47 16.2968 109.556 15.5262C114.285 12.1694 107.174 9.07132 104.347 12.2799"
          {...pathProps}
        />

        {/* see */}
        <motion.path
          d="M8.70312 40.3C9.65261 37.9322 6.06202 34.2605 4.87367 37.2229C3.22324 41.3357 8.05094 45.9659 6.94703 50.164C6.35486 52.4157 1.63068 50.5681 1.06665 48.906C-1.59586 41.0574 18.8667 43.8584 19.2893 40.805C19.6017 38.5313 11.5918 37.9113 12.9763 44.3056C14.4935 48.9919 19.4218 48.063 22.473 44.9888"
          {...pathProps}
        />
        <motion.path
          d="M23.0637 44.616C25.1059 43.3759 28.4205 39.4365 24.5539 39.6288C20.2657 41.1545 21.7434 49.7172 28.9143 47.5516"
          {...pathProps}
        />

        {/* the */}
        <motion.path
          d="M40.6163 29.3728C44.0694 29.1449 36.0074 44.9177 41.616 46.4989"
          {...pathProps}
        />
        <motion.path
          d="M36.9072 38.9626C36.7291 37.8109 50.7599 38.468 50.203 32.4098C48.7366 26.4178 43.8513 41.4304 46.3394 44.4423C46.8248 45.0295 47.0786 43.3483 47.9361 41.9286C48.6219 40.6312 50.2622 37.734 52.1501 38.066C54.5881 38.4949 53.2302 43.1082 55.4912 44.3337C58.4572 45.9409 63.905 39.4126 60.801 38.4243C59.074 37.8746 58.0564 40.192 58.2868 41.7159C58.8347 45.3383 62.9128 45.8191 64.9615 43.3196"
          {...pathProps}
        />

        {/* details */}
        <motion.path
          d="M80.3491 41.2882C80.3491 41.2882 78.9285 35.0433 76.8903 36.5458C73.9647 38.7024 73.7227 43.4898 75.3146 44.3317C81.541 47.6249 81.6296 27.9334 81.6296 27.9334C81.3588 29.8504 78.942 40.2415 82.4247 42.8476C87.6945 46.791 92.9182 35.3572 89.1852 35.7579C85.2479 36.1804 85.6616 40.7571 86.984 42.1845C89.1584 44.5308 93.6236 43.2477 95.9042 38.6044"
          {...pathProps}
        />
        <motion.path
          d="M96.8297 31.4589C96.8452 31.1148 96.7841 30.0975 96.8774 30.4284C97.4737 32.5399 93.1054 47.41 100.458 40.7139"
          {...pathProps}
        />
        <motion.path
          d="M93.0848 33.8554C92.5962 33.8532 96.3358 33.3148 96.8696 33.1838C98.6349 32.7503 100.393 32.2872 102.169 31.9004"
          {...pathProps}
        />
        <motion.path
          d="M101.84 35.4577C106.511 33.225 108.576 36.7724 107.583 40.0871C107.408 40.6273 107.582 38.7233 105.373 37.7789C104.011 37.2621 101.414 37.7017 101.429 39.4027C101.463 43.2577 109.075 41.9521 111.132 39.4053"
          {...pathProps}
        />
        <motion.path
          d="M113.049 33.6259C110.198 35.0827 109.843 45.0945 115.148 40.2626"
          {...pathProps}
        />
        <motion.path d="M115.576 30.5333L114.728 29.5302" {...pathProps} />
        <motion.path
          d="M115.451 35.4994C119.465 37.7463 123.992 26.8814 121.572 26.7689C116.306 26.5224 114.273 45.6933 122.32 40.2253"
          {...pathProps}
        />
        <motion.path
          d="M128.512 35.8679C130.406 32.4857 126.269 31.9367 125.485 34.4746C124.702 37.0126 128.733 38.4728 127.432 40.7986C126.862 41.8156 123.869 42.0778 123.487 38.2268"
          {...pathProps}
        />
      </motion.g>
    </motion.svg>
  );
}
